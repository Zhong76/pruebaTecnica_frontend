<div class="min-h-screen surface-ground p-3 md:p-5">
    <p-toast key="bj" />
    <div class="w-full">
        <div class="surface-card border-round-2xl shadow-2">
            <p-toolbar [style]="{ 'border-radius': '1.25rem', padding: '0.75rem', border: '0' }" styleClass="surface-0">
                <ng-template #start>
                    <div class="flex align-items-center gap-3">
                        <div class="flex align-items-center justify-content-center border-circle surface-100"
                            style="width: 2.5rem; height: 2.5rem;">
                            <i class="pi pi-users text-xl"></i>
                        </div>
                        <div class="flex flex-column">
                            <span class="text-xl font-semibold text-900">Gestión de Usuarios</span>
                            <span class="text-600 text-sm">Búsqueda y gestión de usuarios</span>
                        </div>
                    </div>
                </ng-template>

                <ng-template #end>
                    <div class="flex align-items-center gap-3">
                        <div class="hidden md:flex align-items-center gap-2 text-600">
                            <i class="pi pi-user"></i>
                            <span>Bienvenid@, <span class="font-semibold text-900">{{ user }}</span></span>
                        </div>

                        <p-button icon="pi pi-sign-out" text severity="secondary" rounded pTooltip="Cerrar sesión"
                            tooltipPosition="left" (onClick)="cerrarSesion()">
                        </p-button>
                    </div>
                </ng-template>
            </p-toolbar>
        </div>
        <div class="mt-4 flex align-items-end">
            <form [formGroup]="form" class="w-full flex gap-3">
                <div class="w-2">
                    <p-floatlabel variant="on">
                        <input pInputText id="username" class="w-full" formControlName="username" />
                        <label for="username" class="font-medium text-900">Nombre de Usuario</label>
                    </p-floatlabel>
                </div>
                <div class="w-2 gap-3 flex">
                    <p-button icon="pi pi-search" severity="primary" severity="info" pTooltip="Buscar"
                        tooltipPosition="right" (onClick)="searchUsers()">
                    </p-button>
                    <p-button icon="pi pi-plus" severity="primary" severity="info" pTooltip="Agregar Usuario"
                        tooltipPosition="right" (onClick)="openCreate()">
                    </p-button>
                </div>
            </form>
        </div>
        <div class="surface-card shadow-2 p-3 md:p-4 mt-4">
            <p-table [value]="dataTableUsers" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 20, 50]"
                [responsiveLayout]="'scroll'" styleClass="p-datatable-sm">
                <ng-template pTemplate="header">
                    <tr>
                        <th class="white-space-nowrap">ID</th>
                        <th class="white-space-nowrap">Username</th>
                        <th class="white-space-nowrap">Email</th>
                        <th class="white-space-nowrap">Estado</th>
                        <th class="white-space-nowrap">Creado</th>
                        <th class="white-space-nowrap text-center">Acciones</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-u>
                    <tr>
                        <td class="font-medium text-900">{{ u.id }}</td>
                        <td>{{ u.username }}</td>
                        <td>{{ u.email }}</td>

                        <td>
                            <p-tag [value]="u._status === true ? 'ACTIVO' : 'INACTIVO'"
                                [severity]="u._status === true ? 'success' : 'danger'">
                            </p-tag>
                        </td>

                        <td class="white-space-nowrap">
                            {{ u.createdAt | date:'dd/MM/yyyy' }}
                        </td>

                        <td class="text-center">
                            <div class="flex justify-content-center gap-2">
                                <p-button icon="pi pi-pencil" text rounded severity="info" pTooltip="Editar"
                                    tooltipPosition="top" (onClick)="openEdit(u)">
                                </p-button>

                                <p-button *ngIf="u._status === true" icon="pi pi-trash" text rounded severity="danger" pTooltip="Desactivar"
                                    tooltipPosition="top" (onClick)="inactiveUser(u)">
                                </p-button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>
<p-dialog header="Mantenimiento Usuario" [modal]="true" [(visible)]="visible" [style]="{ width: '45rem' }">
    <app-user-crud [mode]="dialogMode" [user]="userToEdit" (saved)="onSaved($event)" (cancel)="visible = false"></app-user-crud>
</p-dialog>